var d=new TextEncoder,l=new TextDecoder,g=h(),a=Symbol("emptySlot"),i=class{encoder=w;constructor(e={data:null}){let{data:n}=e;this.raw=n}encode(e=this.raw){if(!arguments.length&&!this.raw)throw new Error("data is undefined");switch(arguments[0]===null?"null":typeof arguments[0]){case"null":return this.encoder(226);case"undefined":return this.encoder(227);case"number":return this.encodeNumber(0,e);case"boolean":return this.encoder(e?230:229);case"string":return this.encoder(100,e);case"bigint":return this.encoder(231,e.toString());case"symbol":return this.encoder(232,e.description);case"function":return this.encoder(233,e.toString());case"object":return this.encodeObjectVariant(e)}}encodeNumber(e,n){return Object.is(-0,n)?this.encoder(50):this.encoder(e,Number(n).toString())}encodeObjectVariant(e){if(!arguments.length)throw new Error("data is undefined");switch(e?.constructor??Object){case RegExp:return this.encoder(239,{source:e.source,flags:e.flags});case Error:return this.encoder(240,{message:e.message,cause:e.cause});case URL:return this.encoder(238,e.href);case ArrayBuffer:{let r=new Uint8Array(e);return this.encoder(243,r.toString())}case DataView:{let r=new Uint8Array(e.buffer);return this.encoder(244,r.toString())}case Int8Array:return this.encoder(245,e.toString());case Uint8Array:return this.encoder(249,e.toString());case Uint8ClampedArray:return this.encoder(250,e.toString());case Int16Array:return this.encoder(246,e.toString());case Uint16Array:return this.encoder(251,e.toString());case Int32Array:return this.encoder(247,e.toString());case Uint32Array:return this.encoder(252,e.toString());case Float32Array:return this.encoder(254,e.toString());case Float64Array:return this.encoder(255,e.toString());case BigInt64Array:return this.encoder(248,e.toString());case BigUint64Array:return this.encoder(253,e.toString());case String:return this.encoder(234,e);case Number:return this.encodeNumber(235,e);case Boolean:return this.encoder(236,e);case Date:return this.encoder(237,e.valueOf());case Array:return this.encodeArray(e);case Object:return this.encodeObject(e);case Map:return this.encodeMap(e);case Set:return this.encodeSet(e);default:return this.encodeObject(e)}}encodeArray(e){let n=[],r=0;for(let c of e){if(!(r in e)){n.push(this.encoder(228)),r++;continue}n.push(this.encode(c)),r++}return this.encoder(162,n)}encodeObject(e){let n={};for(let r in e)n[r]=this.encode(e[r]);return this.encoder(194,n)}encodeMap(e){let n=this.encode([...e.entries()]);return this.encoder(242,n)}encodeSet(e){let n=this.encode([...e.values()]);return this.encoder(241,n)}},u=class{decoder=p;constructor(e={data:null}){let{data:n}=e;this.raw=n}decode(e=this.raw){if(!arguments.length&&!this.raw)throw new Error("data is undefined");let[n,r]=this.decoder(e);switch(n){case 0:return+r;case 50:return-0;case 100:return r;case 162:return this.getArray(r);case 194:return this.getObject(r);case 226:return null;case 227:return;case 228:return a;case 229:return!1;case 230:return!0;case 231:return BigInt(r);case 232:return Symbol(r);case 233:return this.getFunction(r);case 234:return new String(r);case 235:return new Number(r);case 236:return new Boolean(r);case 237:return new Date(+r);case 238:return new URL(r);case 239:return new RegExp(r.source,r.flags);case 240:return new Error(r.message,{cause:r.cause});case 241:return new Set(this.decode(r));case 242:return new Map(this.decode(r));case 243:return new Uint8Array(r.split(",")).buffer;case 244:return new DataView(new Uint8Array(r.split(",")).buffer);case 245:return new Int8Array(r.split(","));case 246:return new Int16Array(r.split(","));case 247:return new Int32Array(r.split(","));case 248:return new BigInt64Array(r.split(",").map(c=>BigInt(c)));case 249:return new Uint8Array(r.split(","));case 250:return new Uint8ClampedArray(r.split(","));case 251:return new Uint16Array(r.split(","));case 252:return new Uint32Array(r.split(","));case 253:return new BigUint64Array(r.split(",").map(c=>BigInt(c)));case 254:return new Float32Array(r.split(","));case 255:return new Float64Array(r.split(","));default:return r}}getArray(e){let n=[];for(let r of e){if(this.decode(r)==a){n.length++;continue}n.push(this.decode(r))}return n}getObject(e){let n={};for(let r in e)n[r]=this.decode(e[r]);return n}getFunction(e){if(e.match(/^\s*(async\s*)?function/)||e.match(/^\s*class/)||e.match(/^\s*(.*)\s*=>/))return s(e);return Function("return function "+e)();function s(o){return Function("return "+o)()}}};function b(t){return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function A(t){t=t.replace(/-/g,"+").replace(/_/g,"/");let e=t.length%4;return e&&(t+="=".repeat(4-e)),atob(t)}function f(t){if(!t.match(/^77\+9/))return atob(t);let e=atob(t.replace(/77\+9/,"")),n=Uint8Array.from(e,r=>r.codePointAt(0));return l.decode(n)}function y(t){let e;try{e=btoa(t)}catch(s){e=s}if(typeof e=="string")return e;let n=d.encode("\uFFFD"+t),r=g,c="";for(let s=0;s<n.length;s+=r){let o=n.slice(s,s+r);c+=String.fromCodePoint(...o)}return btoa(c)}function w(t,e){return y(JSON.stringify([t,e]))}function p(t){return JSON.parse(f(t))}function S(t,e){let n=new i().encode(e);try{Deno.writeTextFileSync(t,n)}catch(r){return new Error(r)}finally{return!0}}function m(t){let n=fetch(t).text();return n?new u().decode(n):""}function h(){let t=[],e=16,n=Math.pow(2,e)-1;try{for(;;)t=new Array(n),Function.prototype.apply.call(null,h,t),n=Math.pow(2,e++)-1}catch{return n}}export{u as Decoder,i as Encoder,f as base64ToBytes,A as base64urlDecode,b as base64urlEncode,y as bytesToBase64,m as readencoded,S as writencoded};
