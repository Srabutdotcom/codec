var o=new TextEncoder,y=new TextDecoder,c=class{constructor(e){arguments.length&&(this.raw=e)}async encode(e=this.raw){if(!arguments.length&&!this.raw)throw new Error("data is undefined");let n=e===null?"null":typeof e;switch(n){case"undefined":return btoa(JSON.stringify([n,"undefined"]));case"number":return this.encodeNumber(n,e);case"null":case"boolean":case"string":return btoa(JSON.stringify([n,e]));case"bigint":return btoa(JSON.stringify([n,e.toString()]));case"symbol":return btoa(JSON.stringify([n,e.description]));case"function":return btoa(JSON.stringify([n,e.toString()]));case"object":return await this.encodeObjectVariant(e);default:return btoa(JSON.stringify([n,e]))}}encodeNumber(e,n){let r;switch(n){case n.isNaN:{r="NaN";break}case-1/0:{r="-Infinity";break}case 1/0:{r="Infinity";break}default:r=n;break}return btoa(JSON.stringify([e,r]))}async encodeObjectVariant(e){if(!arguments.length)throw new Error("data is undefined");let n=e?.constructor??Object;switch(n){case RegExp:return btoa(JSON.stringify([n.name,{source:e.source,flags:e.flags}]));case Error:return btoa(JSON.stringify([n.name,{message:e.message,cause:e.cause}]));case Blob:{let r=await e.text();return btoa(JSON.stringify([n.name,r]))}case ArrayBuffer:case DataView:{let r=y.decode(e);return btoa(JSON.stringify([n.name,r]))}case Int8Array:case Uint8Array:case Uint8ClampedArray:case Int16Array:case Uint16Array:case Int32Array:case Uint32Array:case Float32Array:case Float64Array:return btoa(JSON.stringify([n.name,e.toString()]));case BigInt64Array:case BigUint64Array:return btoa(JSON.stringify([n.name,e.toString()]));case String:case Number:case Boolean:case Date:return btoa(JSON.stringify([n.name,e.valueOf()]));case Array:return await this.encodeArray(e);case Object:return await this.encodeObject(e);case Map:return await this.encodeMap(e);case Set:return await this.encodeSet(e);default:return await this.encodeObject(e)}}async encodeArray(e){let n=[];for(let r of e)n.push(await this.encode(r));return btoa(JSON.stringify(["Array",n]))}async encodeObject(e){let n={};for(let r in e)n[r]=await this.encode(e[r]);return btoa(JSON.stringify(["Object",n]))}async encodeMap(e){let n=await this.encode([...e.entries()]);return btoa(JSON.stringify(["Map",n]))}async encodeSet(e){let n=await this.encode([...e.values()]);return btoa(JSON.stringify(["Set",n]))}},i=class{constructor(e){arguments.length&&(this.raw=e)}decode(e=this.raw){if(!arguments.length&&!this.raw)throw new Error("data is undefined");let[n,r]=JSON.parse(atob(e));switch(n){case"string":return r;case"null":return null;case"undefined":return;case"boolean":return r===!0;case"number":return+r;case"bigint":return BigInt(r);case"symbol":return Symbol(r);case"object":return r;case"function":return this.getFunction(r);case"String":return new String(r);case"Number":return new Number(r);case"Boolean":return new Boolean(r);case"Date":return new Date(+r);case"RegExp":return new RegExp(r.source,r.flags);case"Error":return new Error(r.message,{cause:r.cause});case"Blob":return new Blob([r]);case"DataView":return new DataView(o.encode(r).buffer);case"ArrayBuffer":return o.encode(r).buffer;case"Int8Array":return new Int8Array(r.split(","));case"Uint8Array":return new Uint8Array(r.split(","));case"Uint8ClampedArray":return new Uint8ClampedArray(r.split(","));case"Int16Array":return new Int16Array(r.split(","));case"Uint16Array":return new Uint16Array(r.split(","));case"Int32Array":return new Int32Array(r.split(","));case"Uint32Array":return new Uint32Array(r.split(","));case"Float32Array":return new Float32Array(r.split(","));case"Float64Array":return new Float64Array(r.split(","));case"BigInt64Array":return new BigInt64Array(r.split(",").map(a=>BigInt(a)));case"BigUint64Array":return new BigUint64Array(r.split(",").map(a=>BigInt(a)));case"Array":return this.getArray(r);case"Object":return this.getObject(r);case"Map":return new Map(this.decode(r));case"Set":return new Set(this.decode(r));default:return r}}getArray(e){let n=[];for(let r of e){let a=this.decode(r);n.push(a)}return n}getObject(e){let n={};for(let r in e){let a=this.decode(e[r]);n[r]=a}return n}getFunction(e){if(e.match(/^\s*(async\s*)?function/)||e.match(/^\s*class/)||e.match(/^\s*(.*)\s*=>/))return s(e);return Function("return function "+e)();function s(u){return Function("return "+u)()}}};function b(t){return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function w(t){t=t.replace(/-/g,"+").replace(/_/g,"/");let e=t.length%4;return e&&(t+="=".repeat(4-e)),atob(t)}function f(t){let e=atob(t),n=Uint8Array.from(e,r=>r.codePointAt(0));return new TextDecoder().decode(n)}function g(t){let e=new TextEncoder().encode(t),n=String.fromCodePoint(...e);return btoa(n)}var l=g("a \u0100 \u{10000} \u6587 \u{1F984}"),d=f(l);async function A(t,e){let n=await new c().encode(e);try{Deno.writeTextFileSync(t,n)}catch(r){return new Error(r)}finally{return!0}}async function h(t){let n=await(await fetch(t)).text();return n?new i().decode(n):""}export{i as Decoder,c as Encoder,f as base64ToBytes,w as base64urlDecode,b as base64urlEncode,g as bytesToBase64,h as readencoded,A as writencoded};
